# A Routing Transformer and end-sequence degradation [p. 11]

[p. 11] In the analysis, instead of picking the last 10 tokens in a sequence, the last 50 to last 40 tokens are chosen due to an artifact introduced by the clustering heads in the RT model. In general the last 20 tokens in a sequence tend to have increasing perplexity as evaluation is done on longer and longer sequence lengths. As shown in Figure 14, this phenomenon is only native to the RT model and disappears when the clustering heads are replaced with local attentions. Therefore, to make the RT and the LT comparable, the tokens are selected from the range that is not affected by the end-sequence issue. Although it is not the last 10 tokens, this short target chunk is still located near the end of a sequence, preceded by enough long context. [p. 11]

**Figure 14** (p. 12): "Perplexity of target chunk of 10 tokens long near the end of sequence. The legend indicates how far away the evaluated chunk is from the end of sequence (e.g., [-15:-5] means evaluating the last 15 to the last 5 tokens). The left plot shows the clustering mechanism in the Routing Transformer assigns higher perplexity to around the last 15 tokens in a sequence. Due to this artifacts, in our analysis, we avoid tokens within this range to make comparable comparison with the Local Transformer. In the main text, our analysis are conducted over the last 50 to last 40 tokens, which are not affected by this artifact."
- Two panels: "Routing Transformer" (left) and "Local Transformer" (right).
- Legend entries (shared): [-11:-1], [-15:-5], [-20:-10], [-25:-15], [-30:-20], [-40:-30], [-50:-40].
- Left panel (Routing Transformer): X-axis: max sequence length (0-8000); Y-axis: perplexity (~36-48). The [-11:-1] and [-15:-5] lines spike upward sharply as sequence length increases beyond ~4000, reaching perplexity ~47-48 at 8000. The other lines ([-20:-10] through [-50:-40]) remain relatively flat around ~36-38 across all sequence lengths, showing that positions beyond the last 20 tokens are not affected.
- Right panel (Local Transformer): X-axis: max sequence length (0-8000); Y-axis: perplexity (~40-56). All lines decrease from ~52-56 at short sequence lengths to ~40-42 at longer lengths. The end-of-sequence degradation artifact does not appear -- all position ranges show similar behavior, confirming the phenomenon is native to the RT's clustering heads.
